@if (loading) {
    <app-loading></app-loading>
} @else {

    <h1>Stats</h1>

    @if (stats) {
        <!-- Top Times Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h2>Best Times</h2>
                <ul class="list-group">
                    @for (entry of stats.topTimes; track entry.bestTime) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a [routerLink]="['/user', entry.racer.discordUsername]" 
                               style="cursor: pointer" class="text-decoration-none text-dark">
                                {{ entry.racer.displayName }}
                            </a>
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(entry.bestTime) }}
                            </span>
                        </li>
                    }
                </ul>
            </div>
        </div>

        <!-- Average Time Sections -->
        <div class="row mb-4">
            <!-- Average Time Per Round -->
            <div class="col-12 col-md-6 mb-3">
                <h2>Average Time Per Round</h2>
                <ul class="list-group">
                    @if (stats.averageTimePerRound['Round 1']) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Round 1
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(stats.averageTimePerRound['Round 1']) }}
                            </span>
                        </li>
                    }
                    @if (stats.averageTimePerRound['Round 2']) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Round 2
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(stats.averageTimePerRound['Round 2']) }}
                            </span>
                        </li>
                    }
                    @if (stats.averageTimePerRound['Round 3']) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Round 3
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(stats.averageTimePerRound['Round 3']) }}
                            </span>
                        </li>
                    }
                    @if (stats.averageTimePerRound['Quarterfinals']) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Quarterfinals
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(stats.averageTimePerRound['Quarterfinals']) }}
                            </span>
                        </li>
                    }
                    @if (stats.averageTimePerRound['Semifinals']) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Semifinals
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ formatTime(stats.averageTimePerRound['Semifinals']) }}
                            </span>
                        </li>
                    }
                </ul>
            </div>

            <!-- Average Time Per Bracket -->
            <div class="col-12 col-md-6 mb-3">
                <h2>Average Time Per Bracket</h2>
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Playoffs
                        <span class="badge bg-primary rounded-pill p-2">
                            {{ stats.averageTimePerBracket['Playoffs'] ? formatTime(stats.averageTimePerBracket['Playoffs']) : 'N/A' }}
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Ascension
                        <span class="badge bg-success rounded-pill p-2">
                            {{ stats.averageTimePerBracket['Ascension'] ? formatTime(stats.averageTimePerBracket['Ascension']) : 'N/A' }}
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Normal
                        <span class="badge bg-info rounded-pill p-2">
                            {{ stats.averageTimePerBracket['Normal'] ? formatTime(stats.averageTimePerBracket['Normal']) : 'N/A' }}
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Exhibition
                        <span class="badge bg-dark rounded-pill p-2">
                            {{ stats.averageTimePerBracket['Exhibition'] ? formatTime(stats.averageTimePerBracket['Exhibition']) : 'N/A' }}
                        </span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Most Active Commentators Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h2>Most Active Commentators</h2>
                <ul class="list-group">
                    @for (commentator of stats.mostActiveCommentators; track commentator.displayName) {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ commentator.displayName }}
                            <span class="badge bg-dark rounded-pill p-2">
                                {{ commentator.commentatedRaces }}
                            </span>
                        </li>
                    }
                    @if (stats.mostActiveCommentators.length === 0) {
                        <li class="list-group-item">
                            No commentators found
                        </li>
                    }
                </ul>
            </div>
        </div>

    }
}
