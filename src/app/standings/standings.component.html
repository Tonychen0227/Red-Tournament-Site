@if (loading) {
  <app-loading></app-loading>
} @else {

  @if (errorMessage) {
      <div class="alert alert-dismissible alert-primary mt-3">
      <button type="button" class="btn-close" data-bs-dismiss="alert" (click)="clearAlert()"></button>
      {{ errorMessage }}
      </div>
  }

  <div class="container-fluid">

    <h1 class="mb-3">Standings</h1>

    <!-- Best Tournament Time Section -->
    <div class="alert alert-info mb-4" role="alert">
      <h5 class="alert-heading mb-2">🏆 Current Best Tournament Time</h5>
      <div class="row">
        <div class="col-md-6">
          <strong>Time:</strong> {{ bestTournamentTime }}
        </div>
        <div class="col-md-6">
          <strong>Runner:</strong> {{ bestTournamentTimeRunner || 'No runner recorded' }}
        </div>
      </div>
    </div>

      <div class="d-flex align-items-center flex-wrap mb-3">
          <h5 style="display: inline-block" class="me-2 mb-2">Current Bracket:</h5>
          <span class="badge bg-primary me-2 mb-2 px-3 py-2">Playoffs</span>
          <span class="badge bg-success me-2 mb-2 px-3 py-2">Ascension</span>
          <span class="badge bg-info me-2 mb-2 px-3 py-2">Normal</span>
          <span class="badge bg-dark me-2 mb-2 px-3 py-2">Exhibition</span>
      </div>


      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
              <thead class="thead-light">
                <tr>
                  <th scope="col" class="text-center">Rank</th> 
                  <th scope="col">Name</th>
                  <th scope="col" class="text-center">Points</th>
                  <th scope="col" class="text-center">
                    <span class="d-none d-lg-inline">Tiebreaker (Tournament PB)</span>
                    <span class="d-inline d-lg-none">Tie</span>
                  </th>
                </tr>
              </thead>

              <tbody>
                @for (runner of runners; track runner.discordUsername) {
                  <tr>
                    <td class="text-center">{{ runner.rank }}</td>
                    <td>
                      <app-country-flag [countryCode]="runner.country"></app-country-flag><a [routerLink]="['/user', runner.discordUsername]" style="cursor: pointer" 
                        class="badge p-2 text-decoration-none"
                        [ngClass]="{
                            'bg-primary': runner.currentBracket === 'Playoffs',
                            'bg-success': runner.currentBracket === 'Ascension',
                            'bg-info': runner.currentBracket === 'Normal',
                            'bg-dark': runner.currentBracket === 'Exhibition',
                            'bg-secondary': !runner.currentBracket
                        }"
                        [title]="runner.discordUsername">
                      {{ runner.displayName }}
                      </a>
                    </td>
                    <td class="text-center">{{ runner.points }}</td>
                    <td class="text-center">{{ runnerTimeString[runner.discordUsername] }}</td>
                  </tr>
              
                  <!-- Check if the current runner is the last one with rank 9 -->
                  @if (runner.rank === cutoffRank && (runners[$index + 1]?.rank !== cutoffRank || $index === runners.length - 1)) {
                    <tr>
                      <td colspan="4">
                        <hr class="my-2">
                      </td>
                    </tr>
                  }
                }
                @empty {
                  <tr>
                    <td colspan="4" class="text-center">No runners available</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
  </div>
}
