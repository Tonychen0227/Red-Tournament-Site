<h1 class="mb-3">Groups</h1>

<div class="d-flex align-items-center flex-wrap mb-3">
    <h5 style="display: inline-block" class="me-2 mb-2">Bracket Key:</h5>
    <span class="badge bg-primary me-2 mb-2 px-3 py-2">Playoffs</span>
    <span class="badge bg-success me-2 mb-2 px-3 py-2">Ascension</span>
    <span class="badge bg-info me-2 mb-2 px-3 py-2">Normal</span>
    <span class="badge bg-dark me-2 mb-2 px-3 py-2">Exhibition</span>
</div>


<div class="d-flex align-items-center mb-3">
    <h5 style="display: inline-block" class="me-2">Pickems Favorite:</h5>
    <span class="badge bg-dark text-success me-2 px-3 py-2">Runner</span>
</div>


<div class="btn-group mb-3 flex-wrap gap-1 w-100" role="group" aria-label="Round selection radio group">
    @for (round of rounds; track round) {
        <input
            type="radio"
            class="btn-check"
            name="btnradio"
            [id]="'btnradio' + round"
            autocomplete="off"
            [checked]="round === currentRound"
            (change)="onRoundSelected(round)"
        />
        <label
            class="btn flex-grow-1 text-center"
            [class.btn-primary]="round === currentRound"
            [class.btn-outline-primary]="round !== currentRound"
            [for]="'btnradio' + round"
        >
            {{ round }}
        </label>
    }
</div>

@if (loading) {
    <app-loading></app-loading>
} @else {
    @if (filteredGroups.length > 0) {
        <div class="row justify-content-center">
            @for (group of filteredGroups; track group._id) {
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-header text-light d-flex justify-content-between" 
                            [ngClass]="{
                                'bg-primary': group.bracket === 'Playoffs',
                                'bg-success': group.bracket === 'Ascension',
                                'bg-info': group.bracket === 'Normal',
                                'bg-dark': group.bracket === 'Exhibition'
                            }">
                            
                            <strong>Group {{ group.groupNumber }}</strong>

                            <div class="form-check">
                                <input
                                    class="form-check-input bg-dark"
                                    type="checkbox"
                                    [id]="'raceScheduled' + group._id"
                                    [checked]="group.raceStartTime != null"
                                    disabled
                                />
                            </div>
                        </div>
                        <div class="card-body d-flex justify-content-around align-items-center flex-wrap gap-2">
                            @for (member of group.members; track member._id) {
                                <div class="d-flex align-items-center flex-nowrap">
                                    <app-country-flag [countryCode]="member.country"></app-country-flag>
                                    <a 
                                        [routerLink]="['/user', member.discordUsername]" 
                                        style="cursor: pointer" 
                                        class="bg-dark text-decoration-none badge p-2 ms-1"
                                        [ngClass]="{
                                            'text-white': !isFavorite(member._id, group.favorite || []),
                                            'text-success': isFavorite(member._id, group.favorite || [])
                                        }"
                                    >
                                        {{ member.displayName }}
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                </div>


            }
        </div>
    } @else {
        <h2 class="text-center mt-4">
            No groups have been created for this round
        </h2>
    }
}
